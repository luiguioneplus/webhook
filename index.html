<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hola</title>

</head>
<body>
 <h1>welcome</h1>
 <div id="scrapper-status" style="margin-top:20px; font-size:1.2em;"></div>
 <button onclick="consultarEstadoScrapper()">Consultar estado del scrapper</button>


 <!-- Modal -->
 <div id="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5);">
   <div style="background:#fff; padding:30px 20px; border-radius:8px; max-width:350px; margin:120px auto; box-shadow:0 2px 10px #0003; text-align:center; position:relative;">
     <span id="modal-close" style="position:absolute; right:10px; top:10px; cursor:pointer; font-size:1.5em;">&times;</span>
     <div id="modal-content"></div>
   </div>
 </div>

 <script>
function showModal(message, color) {
    document.getElementById('modal-content').innerHTML = message;
    document.getElementById('modal-content').style.color = color;
    document.getElementById('modal').style.display = 'block';
}
document.getElementById('modal-close').onclick = function() {
    document.getElementById('modal').style.display = 'none';
}

function consultarEstadoScrapper() {
    fetch('/webhook/scrapper_status')
        .then(response => response.json())
        .then(data => {
            let div = document.getElementById('scrapper-status');
            // ğŸ’¡ Unificamos la obtenciÃ³n del mensaje: usa 'mensaje' si existe, si no usa 'message'
            let statusMessage = data.mensaje || data.message || 'No hay mensaje de estado disponible.'; 
            
            let color = 'orange';
            let icon = 'âš ï¸';
            
            if (data.status === 'success') {
                div.innerHTML = 'âœ… ' + statusMessage;
                color = 'green';
                icon = 'âœ…';
            } else if (data.status === 'error') {
                // âœ… Corregido para usar la variable statusMessage
                div.innerHTML = 'âŒ ' ; 
                color = 'red';
                icon = 'âŒ';
            } else {
                // âœ… Usa la variable statusMessage
                div.innerHTML = icon + ' ' + statusMessage;
            }
            
            // âœ… Usa statusMessage para el modal tambiÃ©n
            showModal(icon + ' Status: <b>' + data.status + '</b><br>' + statusMessage, color);
        })
        .catch(err => {
            let div = document.getElementById('scrapper-status');
            div.innerHTML = 'Error al consultar el estado.';
            div.style.color = 'gray';
            showModal('Error al consultar el estado. IntÃ©ntelo de nuevo.', 'gray');
        });
}
// Consultar automÃ¡ticamente al cargar la pÃ¡gina
 window.onload = consultarEstadoScrapper;
</script>
</body>
</html>